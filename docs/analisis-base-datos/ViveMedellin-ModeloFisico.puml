@startuml ViveMedellin-Physical-Model

!theme cerulean-outline
title ViveMedellin - Modelo Físico de Base de Datos\n(PostgreSQL 18)

' Configuración de estilos
skinparam backgroundColor #f8f9fa
skinparam classBackgroundColor #ffffff
skinparam classBorderColor #dee2e6
skinparam classHeaderBackgroundColor #e9ecef

' ====================================================================
' ENTIDADES PRINCIPALES
' ====================================================================

entity "**usuarios**" as usuarios {
  --
  **id** : UUID <<PK>>
  --
  nombre : VARCHAR(200) NOT NULL
  email : VARCHAR(320) NOT NULL <<UK>>
  celular : VARCHAR(15)
  documento_identificacion : VARCHAR(20) <<UK>>
  tipo_usuario : tipo_usuario_enum NOT NULL
  activo : BOOLEAN DEFAULT true
  fecha_registro : TIMESTAMP WITH TIME ZONE
  ultima_actividad : TIMESTAMP WITH TIME ZONE
  --
  fecha_creacion : TIMESTAMP WITH TIME ZONE
  fecha_actualizacion : TIMESTAMP WITH TIME ZONE
  usuario_creacion : VARCHAR(100)
  usuario_actualizacion : VARCHAR(100)
}

entity "**organizadores**" as organizadores {
  --
  **id** : UUID <<PK>>
  --
  nombre : VARCHAR(200) NOT NULL
  celular : VARCHAR(15) NOT NULL
  identificacion : VARCHAR(20) NOT NULL <<UK>>
  email : VARCHAR(320) NOT NULL <<UK>>
  validado : BOOLEAN DEFAULT false
  fecha_validacion : TIMESTAMP WITH TIME ZONE
  informacion_adicional : TEXT
  --
  fecha_creacion : TIMESTAMP WITH TIME ZONE
  fecha_actualizacion : TIMESTAMP WITH TIME ZONE
  usuario_creacion : VARCHAR(100)
  usuario_actualizacion : VARCHAR(100)
}

entity "**eventos**" as eventos {
  --
  **id** : UUID <<PK>>
  --
  titulo : VARCHAR(200) NOT NULL
  descripcion : TEXT NOT NULL
  fecha_evento : DATE NOT NULL
  hora_evento : TIME
  categoria : VARCHAR(100) NOT NULL
  modalidad : modalidad_evento_enum DEFAULT 'PRESENCIAL'
  aforo : INTEGER
  valor_ingreso : DECIMAL(10,2) DEFAULT 0.00
  destacado : BOOLEAN DEFAULT false
  imagen_caratula : VARCHAR(500)
  activo : BOOLEAN DEFAULT true
  --
  **organizador_id** : UUID <<FK>>
  **ubicacion_id** : UUID <<FK>>
  **categoria_id** : UUID <<FK>>
  --
  fecha_creacion : TIMESTAMP WITH TIME ZONE
  fecha_actualizacion : TIMESTAMP WITH TIME ZONE
  usuario_creacion : VARCHAR(100)
  usuario_actualizacion : VARCHAR(100)
}

entity "**ubicaciones**" as ubicaciones {
  --
  **id** : UUID <<PK>>
  --
  direccion_completa : VARCHAR(300) NOT NULL
  comuna_barrio : VARCHAR(100) NOT NULL
  direccion_detallada : VARCHAR(300)
  enlace_mapa : VARCHAR(500)
  coordenadas_gps : GEOMETRY(POINT, 4326)
  --
  fecha_creacion : TIMESTAMP WITH TIME ZONE
  fecha_actualizacion : TIMESTAMP WITH TIME ZONE
  usuario_creacion : VARCHAR(100)
  usuario_actualizacion : VARCHAR(100)
}

entity "**categorias_evento**" as categorias_evento {
  --
  **id** : UUID <<PK>>
  --
  nombre : VARCHAR(100) NOT NULL <<UK>>
  descripcion : TEXT
  icono : VARCHAR(50)
  activa : BOOLEAN DEFAULT true
  --
  fecha_creacion : TIMESTAMP WITH TIME ZONE
  fecha_actualizacion : TIMESTAMP WITH TIME ZONE
  usuario_creacion : VARCHAR(100)
  usuario_actualizacion : VARCHAR(100)
}

' ====================================================================
' ENTIDADES DEPENDIENTES (COMPOSICIÓN)
' ====================================================================

entity "**funciones**" as funciones {
  --
  **id** : UUID <<PK>>
  --
  **evento_id** : UUID <<FK>> NOT NULL
  fecha_funcion : DATE NOT NULL
  hora_inicio : TIME NOT NULL
  hora_fin : TIME
  aforo_funcion : INTEGER
  activa : BOOLEAN DEFAULT true
  --
  fecha_creacion : TIMESTAMP WITH TIME ZONE
  fecha_actualizacion : TIMESTAMP WITH TIME ZONE
  --
  <<UK>> (evento_id, fecha_funcion, hora_inicio)
}

entity "**valoraciones**" as valoraciones {
  --
  **id** : UUID <<PK>>
  --
  **evento_id** : UUID <<FK>> NOT NULL
  **usuario_id** : UUID <<FK>> NOT NULL
  calificacion : INTEGER NOT NULL CHECK(1-5)
  comentario : TEXT
  moderada : BOOLEAN DEFAULT false
  fecha_valoracion : TIMESTAMP WITH TIME ZONE
  --
  <<UK>> (evento_id, usuario_id)
}

entity "**multimedia**" as multimedia {
  --
  **id** : UUID <<PK>>
  --
  **evento_id** : UUID <<FK>> NOT NULL
  tipo_multimedia : tipo_multimedia_enum NOT NULL
  url_archivo : VARCHAR(500) NOT NULL
  descripcion : TEXT
  orden_visualizacion : INTEGER DEFAULT 1
  --
  fecha_creacion : TIMESTAMP WITH TIME ZONE
  fecha_actualizacion : TIMESTAMP WITH TIME ZONE
  --
  <<UK>> (evento_id, orden_visualizacion)
}

entity "**servicios_adicionales**" as servicios_adicionales {
  --
  **id** : UUID <<PK>>
  --
  **evento_id** : UUID <<FK>> NOT NULL
  nombre_servicio : VARCHAR(100) NOT NULL
  descripcion_servicio : TEXT
  costo_adicional : DECIMAL(10,2) DEFAULT 0.00
  incluido_entrada : BOOLEAN DEFAULT false
  --
  fecha_creacion : TIMESTAMP WITH TIME ZONE
  fecha_actualizacion : TIMESTAMP WITH TIME ZONE
  --
  <<UK>> (evento_id, nombre_servicio)
}

' ====================================================================
' TIPOS ENUMERADOS
' ====================================================================

note top of usuarios : **Tipos Enumerados:**\ntipo_usuario_enum:\n• CIUDADANO\n• ORGANIZADOR\n• ADMINISTRADOR

note top of eventos : **Tipos Enumerados:**\nmodalidad_evento_enum:\n• PRESENCIAL\n• VIRTUAL\n• HIBRIDA

note top of multimedia : **Tipos Enumerados:**\ntipo_multimedia_enum:\n• IMAGEN\n• VIDEO\n• AUDIO\n• DOCUMENTO

' ====================================================================
' RELACIONES PRINCIPALES
' ====================================================================

' Relaciones 1:N principales
organizadores ||--o{ eventos : "organiza\n(1:N)"
ubicaciones ||--o{ eventos : "se_realiza_en\n(N:1)"
categorias_evento ||--o{ eventos : "clasifica\n(1:N)"

' Relaciones de composición (1:N con eliminación en cascada)
eventos ||--o{ funciones : "tiene_funciones\n(1:N)\n<<CASCADE>>"
eventos ||--o{ multimedia : "tiene_multimedia\n(1:N)\n<<CASCADE>>"
eventos ||--o{ servicios_adicionales : "ofrece_servicios\n(1:N)\n<<CASCADE>>"

' Relación N:M (entidad asociativa)
usuarios ||--o{ valoraciones : "realiza\n(1:N)"
eventos ||--o{ valoraciones : "recibe\n(1:N)"

' ====================================================================
' ÍNDICES PRINCIPALES
' ====================================================================

note bottom of eventos : **Índices Principales:**\n• idx_eventos_organizador_id\n• idx_eventos_ubicacion_id\n• idx_eventos_fecha_activo\n• idx_eventos_categoria_fecha\n• idx_eventos_destacado_fecha\n• idx_eventos_titulo_gin (Full Text)\n• idx_eventos_descripcion_gin (Full Text)

note bottom of valoraciones : **Índices:**\n• idx_valoraciones_evento_id\n• idx_valoraciones_usuario_id\n• idx_valoraciones_evento_calificacion\n• uk_valoracion_usuario_evento (UNIQUE)

note bottom of ubicaciones : **Índices:**\n• idx_ubicaciones_comuna\n• idx_ubicaciones_coordenadas_gps (GIST)\n  Para búsquedas geoespaciales

note bottom of funciones : **Índices:**\n• idx_funciones_evento_id\n• idx_funciones_fecha\n• uk_funcion_evento_fecha_hora (UNIQUE)

' ====================================================================
' RESTRICCIONES DE INTEGRIDAD
' ====================================================================

note right of eventos : **Restricciones CHECK:**\n• fecha_evento >= CURRENT_DATE\n• aforo > 0 OR aforo IS NULL\n• valor_ingreso >= 0\n\n**Triggers:**\n• tr_validar_organizador_evento\n• tr_eventos_auditoria

note left of valoraciones : **Restricciones:**\n• calificacion BETWEEN 1 AND 5\n• Un usuario por evento (UK)\n• Eliminación en cascada

note right of organizadores : **Restricciones:**\n• email formato válido\n• celular 10-15 dígitos\n• identificación única\n\n**Validación:**\n• Solo validados crean eventos

' ====================================================================
' INFORMACIÓN ADICIONAL
' ====================================================================

note bottom : **ViveMedellin - Modelo Físico PostgreSQL 18**\n\n**Características Técnicas:**\n• UUIDs como claves primarias\n• Auditoría automática con triggers\n• Soft delete en entidades principales\n• Full Text Search en español\n• Soporte PostGIS para coordenadas\n• Row Level Security (RLS) disponible\n\n**Cardinalidades Estimadas:**\n• Usuarios: ~100,000 registros\n• Organizadores: ~2,000 registros\n• Eventos: ~10,000 registros/año\n• Valoraciones: ~50,000 registros/año\n• Funciones: 1.5 promedio por evento\n\n**Base de Datos:** vivemedellin\n**Puerto:** 5432\n**Esquema:** public

@enduml