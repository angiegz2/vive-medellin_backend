@startuml C4_Complete_ViveMedellin
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

title Arquitectura Completa C4 - Plataforma ViveMedellin

' ================== NIVEL 1: CONTEXTO ==================
Person(ciudadano, "Ciudadano de MedellÃ­n", "Usuario que busca y participa en eventos locales")
Person(organizador, "Organizador de Eventos", "Crea y gestiona eventos en la plataforma")
Person(admin, "Administrador", "Gestiona la plataforma y supervisa contenido")

System_Ext(email_sys, "Sistema de Email", "SendGrid/AWS SES")
System_Ext(payment_sys, "Pasarela de Pagos", "Stripe/PayU Colombia") 
System_Ext(maps_sys, "Google Maps API", "GeolocalizaciÃ³n")
System_Ext(social_sys, "Redes Sociales", "Facebook, Instagram, Twitter")

' ================== NIVEL 2: CONTENEDORES ==================
System_Boundary(vivemedellin, "Plataforma ViveMedellin") {
    
    ' Frontend Containers
    Container(web_app, "Web Application", "React.js + TypeScript", "Interface web responsive para usuarios")
    Container(mobile_app, "Mobile App", "React Native", "AplicaciÃ³n nativa iOS/Android")
    Container(admin_panel, "Admin Panel", "React.js + Material-UI", "Panel administrativo avanzado")
    
    ' Backend Containers
    Container(api_gateway, "API Gateway", "Spring Cloud Gateway", "Enrutamiento y autenticaciÃ³n")
    
    ' ================== NIVEL 3: COMPONENTES BACKEND ==================
    Container_Boundary(backend_api, "Backend API - Spring Boot 3.5.6") {
        
        ' Controllers
        Component(evento_ctrl, "EventoController", "Spring @RestController", "API REST eventos")
        Component(usuario_ctrl, "UsuarioController", "Spring @RestController", "API REST usuarios")
        Component(valoracion_ctrl, "ValoracionController", "Spring @RestController", "API REST valoraciones")
        Component(notif_ctrl, "NotificacionController", "Spring @RestController", "API REST notificaciones")
        
        ' Services
        Component(evento_svc, "EventoService", "Spring @Service", "LÃ³gica de negocio eventos")
        Component(usuario_svc, "UsuarioService", "Spring @Service", "LÃ³gica de negocio usuarios")
        Component(valoracion_svc, "ValoracionService", "Spring @Service", "LÃ³gica valoraciones")
        Component(search_svc, "SearchService", "Spring @Service", "BÃºsqueda avanzada")
        Component(notif_svc, "NotificationService", "Spring @Service", "GestiÃ³n notificaciones")
        
        ' Repositories
        Component(evento_repo, "EventoRepository", "Spring Data JPA", "Acceso datos eventos")
        Component(usuario_repo, "UsuarioRepository", "Spring Data JPA", "Acceso datos usuarios")
        Component(valoracion_repo, "ValoracionRepository", "Spring Data JPA", "Acceso valoraciones")
        Component(funcion_repo, "FuncionRepository", "Spring Data JPA", "Acceso funciones")
        
        ' Configuration
        Component(security_config, "SecurityConfig", "Spring Security", "JWT + CORS")
        Component(swagger_config, "OpenAPIConfig", "SpringDoc", "DocumentaciÃ³n automÃ¡tica")
        Component(exception_handler, "ExceptionHandler", "Spring @ControllerAdvice", "Manejo errores")
    }
    
    ' Microservices
    Container(auth_service, "Auth Service", "Spring Security + JWT", "AutenticaciÃ³n y autorizaciÃ³n")
    Container(notification_service, "Notification Service", "Spring Boot + WebSocket", "Notificaciones tiempo real")
    
    ' Storage
    Container(file_storage, "File Storage", "MinIO/AWS S3", "ImÃ¡genes y documentos")
}

' ================== PERSISTENCIA ==================
ContainerDb(postgresql, "PostgreSQL 18", "Base de Datos Principal", "Almacenamiento ACID")
ContainerDb(redis, "Redis Cluster", "Cache Distribuido", "Sesiones y cache")
ContainerDb(elasticsearch, "Elasticsearch", "Motor de BÃºsqueda", "Ãndices optimizados")

' ================== RELACIONES USUARIOS ==================
Rel(ciudadano, web_app, "Busca eventos, valora", "HTTPS")
Rel(ciudadano, mobile_app, "App mÃ³vil nativa", "HTTPS")
Rel(organizador, web_app, "Gestiona eventos", "HTTPS")
Rel(admin, admin_panel, "Administra plataforma", "HTTPS")

' ================== RELACIONES FRONTEND - GATEWAY ==================
Rel(web_app, api_gateway, "Consume APIs", "HTTPS/JSON")
Rel(mobile_app, api_gateway, "REST API calls", "HTTPS/JSON") 
Rel(admin_panel, api_gateway, "Admin APIs", "HTTPS/JSON")

' ================== GATEWAY - SERVICES ==================
Rel(api_gateway, evento_ctrl, "Enruta /api/eventos/*", "HTTP")
Rel(api_gateway, usuario_ctrl, "Enruta /api/usuarios/*", "HTTP")
Rel(api_gateway, auth_service, "ValidaciÃ³n JWT", "HTTP")
Rel(api_gateway, notification_service, "Notificaciones", "HTTP")

' ================== CONTROLLERS - SERVICES ==================
Rel(evento_ctrl, evento_svc, "DelegaciÃ³n lÃ³gica", "Java")
Rel(usuario_ctrl, usuario_svc, "GestiÃ³n usuarios", "Java")
Rel(valoracion_ctrl, valoracion_svc, "Procesa valoraciones", "Java")
Rel(notif_ctrl, notif_svc, "EnvÃ­a notificaciones", "Java")

' ================== SERVICES - REPOSITORIES ==================
Rel(evento_svc, evento_repo, "CRUD eventos", "JPA")
Rel(evento_svc, funcion_repo, "Gestiona funciones", "JPA")
Rel(usuario_svc, usuario_repo, "CRUD usuarios", "JPA")
Rel(valoracion_svc, valoracion_repo, "CRUD valoraciones", "JPA")

' ================== INTER-SERVICE COMMUNICATION ==================
Rel(evento_svc, search_svc, "Indexa eventos", "Java")
Rel(evento_svc, notif_svc, "Notifica nuevo evento", "Java")
Rel(usuario_svc, notif_svc, "Notifica registro", "Java")

' ================== REPOSITORIES - DATABASE ==================
Rel(evento_repo, postgresql, "SQL eventos", "JDBC")
Rel(usuario_repo, postgresql, "SQL usuarios", "JDBC")
Rel(valoracion_repo, postgresql, "SQL valoraciones", "JDBC")
Rel(funcion_repo, postgresql, "SQL funciones", "JDBC")

' ================== CACHE LAYER ==================
Rel(evento_svc, redis, "Cache eventos populares", "Redis Protocol")
Rel(usuario_svc, redis, "Cache perfiles", "Redis Protocol")
Rel(auth_service, redis, "Cache sesiones JWT", "Redis Protocol")

' ================== SEARCH ENGINE ==================
Rel(search_svc, elasticsearch, "Indexa/Busca eventos", "HTTP/JSON")

' ================== EXTERNAL SERVICES ==================
Rel(notification_service, email_sys, "EnvÃ­a emails", "SMTP/API")
Rel(evento_svc, payment_sys, "Procesa pagos", "HTTPS/API")
Rel(evento_svc, maps_sys, "Geocodifica direcciones", "HTTPS/API")
Rel(notification_service, social_sys, "Comparte eventos", "HTTPS/API")
Rel(evento_svc, file_storage, "Gestiona imÃ¡genes", "S3 API")

' ================== CROSS-CUTTING CONCERNS ==================
Rel(security_config, auth_service, "ConfiguraciÃ³n JWT", "Spring")
Rel(exception_handler, evento_ctrl, "Maneja excepciones", "AOP")
Rel(swagger_config, evento_ctrl, "DocumentaciÃ³n API", "Annotations")

' ================== NIVEL 4: MODELO DE DOMINIO (RepresentaciÃ³n) ==================
note top of postgresql : "ğŸ—ï¸ MODELO DE DOMINIO\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“‹ Evento (entidad principal)\nâ”œâ”€â”€ id, nombre, descripciÃ³n\nâ”œâ”€â”€ fecha, ubicaciÃ³n, precio\nâ”œâ”€â”€ categoria (enum), organizador\nâ”œâ”€â”€ activo, destacado (flags)\nâ””â”€â”€ timestamps automÃ¡ticos\n\nğŸ‘¤ Usuario\nâ”œâ”€â”€ id, nombre, email, telÃ©fono\nâ”œâ”€â”€ tipo (CIUDADANO|ORGANIZADOR|ADMIN)\nâ”œâ”€â”€ activo (soft delete)\nâ””â”€â”€ fechaRegistro\n\nâ­ Valoracion\nâ”œâ”€â”€ eventoId, usuarioId\nâ”œâ”€â”€ puntuaciÃ³n (1-5), comentario\nâ””â”€â”€ fecha\n\nğŸª FunciÃ³n\nâ”œâ”€â”€ eventoId, fecha, capacidad\nâ”œâ”€â”€ entradasVendidas, precio\nâ””â”€â”€ activa\n\nğŸ“¢ NotificaciÃ³n\nâ”œâ”€â”€ usuarioId, titulo, mensaje\nâ”œâ”€â”€ tipo (enum), leÃ­da\nâ””â”€â”€ fecha\n\nğŸ¢ Organizador\nâ”œâ”€â”€ nombre, contacto, descripciÃ³n\nâ””â”€â”€ verificado\n\nğŸ“ UbicaciÃ³n\nâ”œâ”€â”€ nombre, direcciÃ³n\nâ”œâ”€â”€ latitud, longitud\nâ””â”€â”€ capacidad"

' ================== ANNOTATIONS ==================
note right of vivemedellin : "ğŸ¯ CARACTERÃSTICAS CLAVE\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâœ… CRUD Completo\nâœ… Soft Delete (eventos)\nâœ… Sistema Valoraciones\nâœ… BÃºsqueda Avanzada\nâœ… Cache Distribuido\nâœ… Notificaciones Real-time\nâœ… Multi-perfil (dev/prod)\nâœ… DocumentaciÃ³n Swagger\nâœ… JWT Authentication\nâœ… GeolocalizaciÃ³n\nâœ… Sistema de Pagos"

note left of postgresql : "ğŸš€ STACK TECNOLÃ“GICO\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“± Frontend: React.js + React Native\nğŸ–¥ï¸ Backend: Spring Boot 3.5.6\nâ˜• Runtime: Java 21/23\nğŸ—„ï¸ Database: PostgreSQL 18\nâš¡ Cache: Redis Cluster\nğŸ” Search: Elasticsearch\nğŸ” Security: Spring Security + JWT\nğŸ“š API Docs: SpringDoc OpenAPI\nğŸ³ Container: Docker Ready\nâ˜ï¸ Cloud: AWS/Azure Ready"

SHOW_LEGEND()

@enduml